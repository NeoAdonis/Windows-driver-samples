name: Build driver sample
on:
  push:
    branches:
      - actions-test
jobs:
  build:
    strategy:
      fail-fast: false
      matrix:
        configuration: [Debug, Release]
        platform: [x64, arm64]
    runs-on: windows-2019
    env:
      Solution_Path: general\echo\kmdf\kmdfecho.sln
    steps:
      - run: echo "üéâ Job automatically triggered by a ${{ github.event_name }} event."
      - run: echo "üñ•Ô∏è Running on ${{ runner.os }}"

      # Check out code
      - name: Check out repository code
        uses: actions/checkout@v3

      # Add MSBuild to the PATH: https://github.com/microsoft/setup-msbuild
      - name: Setup MSBuild.exe
        uses: microsoft/setup-msbuild@v1.0.2
      
      # Build sample directly
      - name: Build sample
        run: msbuild $env:Solution_Path -t:clean,build -verbosity:diag -property:Configuration=$env:Configuration -property:Platform=$env:Platform -p:InfVerif_AdditionalOptions="/msft /sw1205 /sw1324 /sw1420 /sw1421" -p:SignToolWS=/fdws -p:DriverCFlagAddOn=/wd4996
        env:
          Configuration: ${{ matrix.configuration }}
          Platform: ${{ matrix.platform }}

